% requirements:
%	TeX environments: TeXlive/MacTeX or MiKTeX
%	compiler: XeLaTeX
%
% ---------------------------------------------------------------------------- %
%                                   preamble                                   %
% ---------------------------------------------------------------------------- %
\documentclass[a4paper]{article}
% 10.5pt = 5 hao

% ---------------------------------- layout ---------------------------------- %
\usepackage[a4paper,top=2.5cm,bottom=2.5cm,left=3cm,right=3cm,% margins
			headheight=1.5cm,headsep=1.5em,
			footskip=2em,
			]{geometry}

% ------------------------------- math symbols ------------------------------- %
% 载入常用的数学包, 符号包
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{mathrsfs}
\usepackage{blindtext}
\usepackage{minted}

%----------------------------------------------------------------%
%% linespace 行间距，段间距等等
\usepackage{setspace}
% \usepackage{indentfirst} % then the first line of each title should start with a indent.
% 定义标题和段落样式
% 定义1.5倍行距
\renewcommand{\baselinestretch}{1.62}
\setlength{\baselineskip}{12pt}   % set the fixed value of the lineskip
\setlength\parskip{\baselineskip} % set the space between the paragraphs, set the variable \parskip \baselineskip
% parindent
\setlength{\parindent}{0pt}

%----------------------------------------------------------------%
% fonts (style, color, size). 字体的大小，颜色，以及定义常用的字号
\usepackage{ctex}		 	% If you are lazy, the CTEX suit is enough.
% Chinese font
\usepackage{xeCJK}		 	% For the Chinese through XeLaTex
\setCJKmainfont{SimSun} 	% set the mainfont of Chinese as songti. (serif) for
\setCJKsansfont{SimSun} 	% sans serif font for \textsf
\setCJKmonofont{SimSun} 	% monospace font for \texttt
% \punctstyle{kaiming}  	% Remove the space used by symbols like comma. Special for the mainland students like us HUSTers.
\setCJKfamilyfont{song}{SimSun}                       % 宋体 song
\newcommand{\song}{\CJKfamily{song}}
\setCJKfamilyfont{kai}{KaiTi}                         % 楷体  kai
\newcommand{\kai}{\CJKfamily{kai}}
\setCJKfamilyfont{hwzs}{STZhongsong}                  % 华文中宋  hwzs
\newcommand{\hwzs}{\CJKfamily{hwzs}}
\setCJKfamilyfont{hei}{SimHei}                        % 黑体  hei
\newcommand{\hei}{\CJKfamily{hei}}
% English font
\usepackage{fontspec}% Then you can use the fonts installed at your device.
\setmainfont{Times New Roman}
\setsansfont{Times New Roman}
\setmonofont{Times New Roman}
%\setsansfont{[foo.ttf]} % for the fonts at this default path.
% font Color 利用definecolor自己可以定义颜色
\usepackage{xcolor}
\definecolor{MSBlue}{rgb}{.204,.353,.541}
\definecolor{MSLightBlue}{rgb}{.31,.506,.741}
% font Size (I use pinyin represents the corresponding size in Microsorft Word)
% \newcommand{\chuhao}{\fontsize{42pt}{\baselineskip}\selectfont}
\newcommand{\xiaochuhao}{\fontsize{36pt}{\baselineskip}\selectfont}
% \newcommand{\yihao}{\fontsize{28pt}{\baselineskip}\selectfont}
\newcommand{\erhao}{\fontsize{21pt}{\baselineskip}\selectfont}
\newcommand{\xiaoerhao}{\fontsize{18pt}{\baselineskip}\selectfont}
\newcommand{\sanhao}{\fontsize{15.75pt}{\baselineskip}\selectfont}
\newcommand{\sihao}{\fontsize{14pt}{18pt}\selectfont}
\newcommand{\xiaosihao}{\fontsize{12pt}{18pt}\selectfont}
\newcommand{\wuhao}{\fontsize{10.5pt}{18pt}\selectfont}
% \newcommand{\xiaowuhao}{\fontsize{9pt}{\baselineskip}\selectfont}
% \newcommand{\liuhao}{\fontsize{7.875pt}{\baselineskip}\selectfont}
% \newcommand{\qihao}{\fontsize{5.25pt}{\baselineskip}\selectfont}


% ---------------------------------------------------------------------------- %
%% header and footer 页眉，页脚
\usepackage{fancyhdr} % for header and footer

% 设置页眉样式
\newcommand{\headstyle}{
 \fancyhead[C]{ \hwzs\wuhao 华\hspace{0.5em}中\hspace{0.5em}科\hspace{0.5em}技\hspace{0.5em}大\hspace{0.5em}学\hspace{0.5em}课\hspace{0.5em}程\hspace{0.5em}设\hspace{0.5em}计\hspace{0.5em}(报\hspace{0.5em}告)}
}

% 设置页脚样式
\newcommand{\footstyle}{\fancyfoot[C]{\wuhao\thepage}
 \fancyfoot[L]{\rule[5pt]{6.7cm}{0.4pt}}
 \fancyfoot[R]{\rule[5pt]{6.7cm}{0.4pt}}
}
\pagestyle{fancy}
\fancyhf{} % 清空原有样式
\headstyle
\footstyle
% 定义一种新的格式叫做main
\fancypagestyle{main}{%
 \fancyhf{} % 清空原有样式
 \headstyle
 \footstyle
}
\renewcommand{\headrulewidth}{0.4pt}
% \renewcommand{\footrulewidth}{0.4pt}
% \renewcommand{\headrule}{\rule{\textwidth}{0.4pt}}

% ---------------------------------------------------------------------------- %
% set the styles of sections at all levels
% 设置各个标题样式
% 不需要使用part和chapter层级
\usepackage{titlesec}
\usepackage{titletoc}
\titleformat{\section}{\centering\hei\bfseries\xiaoerhao}{\thesection}{1em}{} % 在section标题编号后面加个点
% \titlelabel{\thetitle.\quad} % add a dot after the counter for all levels of sections
% \titleformat*{\section}{\wuhao\bfseries} % 设置标签的形式，5号加粗
\titleformat*{\subsection}{\raggedright\hei\bfseries\sihao}
\titleformat*{\subsubsection}{\raggedright\hei\bfseries\xiaosihao}
\titleformat{\paragraph}[hang]{\raggedright\hei\bfseries\xiaosihao}{\theparagraph}{1em}{}[]

% manual
% \titleformat{command}[shape]{format}{label}{sep}{before-code}[after-code]
% \titlespacing{command}{left}{before-sep}{after-sep}
% 设置新的层级subsubsubsection
\setcounter{tocdepth}{4}
\setcounter{secnumdepth}{4}

\newcommand{\sectionbreak}{\clearpage} % 小节从新的一页开始
% 根据学校要求设置新的section, subsection, subsection,  paragraph

% set the content of section and so on
\newcommand\seccontent{
	\song
	\xiaosihao % 默认五号字体, 行间距为1.5*\baselineskip
    \setlength{\parindent}{2em} % 首段缩进两个M字符
    \setlength{\parskip}{0pt}
    }
\newcommand\tabcontent{
	\song
	\wuhao % 默认五号字体, 行间距为1.5*\baselineskip
	\setlength{\parindent}{2em} % 首段缩进两个M字符
	\setlength{\parskip}{0pt}
}


% ---------------------------------------------------------------------------- %
% for the style of theorems, definitions, proofs and remarks 定义数学里面一些常用的环境
\usepackage{amsthm}
\newtheorem{thm}{\textbf{定理}}[section]
% The section in [] can be replaced by chapter or subsection
\theoremstyle{definition} 
\theoremstyle{plain}
\theoremstyle{remark}

% ---------------------------------------------------------------------------- %
% for the caption and reference 图表及公式的编号规范
\usepackage{float} 		 		  	% table figure positioning
\usepackage{caption}
\captionsetup[figure]{labelformat=default, labelsep=quad,name={图}}
\captionsetup[table]{labelformat=default,labelsep=quad,name={表}}
% 设置图表标题的计数方式
\renewcommand{\thefigure}{\ifnum \thesection>0 \thesection-\fi \arabic{figure}} % set caption label style to 2-1
\renewcommand{\thetable}{\ifnum \thesection>0 \thesection-\fi \arabic{table}} % set caption label style to 2-1
\DeclareCaptionFont{mylabelfont}{\hei\xiaosihao}
\captionsetup[figure]{font=mylabelfont}
\captionsetup[table]{font=mylabelfont}

% 设置图表的autoref的格式
\newcommand{\reffig}[1]{图 \ref{#1}}
\newcommand{\reftab}[1]{表 \ref{#1}}
% 公式的编号格式
\renewcommand\theequation{\arabic{section}-\arabic{equation}}

\usepackage{graphicx} % To include graphixs 添加图所需的包

\graphicspath{{./graphics/}} %设置图片路径
\usepackage{booktabs} % To create three line table including the commands toprule, bottomrule, and midrule
% \usepackage{colortbl} %
% 使用tabularx库并定义新的左右中格式
\usepackage{tabularx}
\usepackage{makecell}
\newcolumntype{L}{X}
\newcolumntype{C}{>{\centering \arraybackslash}X}
\newcolumntype{R}{>{\raggedright \arraybackslash}X}

% ---------------------------------------------------------------------------- %
% set the style of counters 设置计数器
% 设置重新计数的位置
\makeatletter
\@addtoreset{footnote}{page}
\@addtoreset{figure}{section}
\@addtoreset{table}{section}
\@addtoreset{equation}{section}
\makeatother

% ---------------------------------------------------------------------------- %
% tableofcontents, listoftables and listoffigures 目录
%\renewcommand\listfigurename{插图列表}
%\renewcommand\listtablename{表格列表}
%\titlecontents{标题名}[左间距]{标题格式}{标题标志}{无序号标题}{指引线与页码}[下间距]
%\dottedcontents{section}[2.55em]{\song \xiaosihao \bfseries}{2.5em}{1em}
\usepackage{tocloft}
\renewcommand{\contentsname}{\centerline{ \hei\bfseries\xiaoerhao 目\hspace{2em}录}}
\titlecontents{section}[3em]{\song\xiaosihao\bfseries}{\contentslabel{3em}}{\hspace*{-3em}}{\normalfont\titlerule*[8pt]{.}\contentspage}
\titlecontents{subsection}[3em]{\song\xiaosihao}{\contentslabel{3em}}{\hspace*{-3em}}{\titlerule*[8pt]{.}\contentspage}
\titlecontents{subsubsection}[4em]{\song\xiaosihao}{\contentslabel{4em}}{\hspace*{-4em}}{\titlerule*[8pt]{.}\contentspage}
\titlecontents{paragraph}[5em]{\song\xiaosihao}{\contentslabel{5em}}{\hspace*{-5em}}{\titlerule*[8pt]{.}\contentspage}

% ---------------------------------------------------------------------------- %
% reference and citation 参考文献
\usepackage{natbib}
\renewcommand{\refname}{\centering\hei\xiaoerhao 参考文献}
\bibsep=0pt % 用来设置每个\bibitem之间的间距
% \renewcommand{\bibname}{HUSTthesis} % .bib name
% \newcommand{\upcite}[1]{\textsuperscript{\textsuperscript{\cite{#1}}}} % show citation label in the upperscript

% ---------------------------------------------------------------------------- %
% 设置声明页
% 使用特殊符号
\usepackage{amssymb}
\usepackage{wasysym}
% 制作tatement中的符号
\def\HUSTcheckedbox{$\Square\!\!\!\!\checkmark$}
\def\HUSTbox{$\Square$}


% ---------------------------------------------------------------------------- %
% 定义中英文摘要和致谢环境
%
% 中文摘要环境
\newenvironment{cnabstract}[1]{
	\def \cnkeyword {#1}
	\clearpage
	\phantomsection
	\addcontentsline{toc}{section}{摘要}
	\vspace*{-20pt}
	\begin{center}
		\heiti \bfseries \xiaoerhao 摘 \hspace{2em} 要
	\end{center}
	\seccontent
}{
	\vspace{1em}
	\par\noindent {\hei\sihao \bfseries 关键词：} {\song\xiaosihao\cnkeyword}

}

% 英文摘要环境
\newenvironment{enabstract}[1]{
	\def \enkeyword {#1}
	\clearpage
	\phantomsection
	\addcontentsline{toc}{section}{Abstract}
	\vspace*{-20pt}
	\begin{center}
		\bfseries \xiaoerhao Abstract
	\end{center}
	\seccontent
}{
	\vspace{1em}
	\par\noindent {\sihao\bfseries Key Words: }\ {\song\xiaosihao\enkeyword}
	\clearpage
}

% 定义致谢环境
\newenvironment{thankpage}{
	\clearpage%
	\phantomsection%
	\addcontentsline{toc}{section}{致谢}%
	\section*{致\hspace{2em}谢}%
}{
	\clearpage
}


% ---------------------------------------------------------------------------- %
%	---	定义列表项，列举的样式
\usepackage{enumitem}
\setlist{noitemsep}

% ---------------------------------------------------------------------------- %
% \usepackage{makeindex} For the index 索引
\usepackage{listings} % For the code. 代码

% ---------------------------------------------------------------------------- %
% 设置脚注

% ---------------------------------------------------------------------------- %
%% For the hyperlink and bookmark 超链接及书签，(这样生成的pdf中的引用直接点击链接即可到达目的地)
\usepackage[bookmarks=true,colorlinks,linkcolor=black,citecolor=black,urlcolor=purple]{hyperref}% 设置超链接并修改风格


% ---------------------------------------------------------------------------- %
%% For the appendix, 附录
% 设置附录
\usepackage{appendix}
\renewcommand{\appendixname}{附录}

% ---------------------------------------------------------------------------- %
% for the titlepage 标题页，此处可以省略，建议直接使用官方给出的标题页即可
\usepackage{titling}
% 重置命令 maketitle
\renewcommand{\maketitle}{
	\def\HUSTtitlelength{12em}
 	\begin{titlepage}
		\begin{center}
			\vspace*{0em}
			\includegraphics[height=1.61cm]{HUSTlogo.eps}\\
%
			\vspace*{4em}
%
			{\xiaochuhao \hwzs \bfseries 模电课程设计}\\
%
			\vspace*{6em}
			{\erhao \hei \bfseries \thetitle}

			\vspace*{6em}
			{\sanhao \hwzs
				\renewcommand\arraystretch{2.7}
				\begin{tabular}{lc}
					\makebox[4em][s]{院 \hfill 系} &
					\underline{\makebox[\HUSTtitlelength]{\school}} \\
					\makebox[4em][s]{专业班级} &
					\underline{\makebox[\HUSTtitlelength]{\classnum}} \\
					\makebox[4em][s]{姓 \hfill 名} &
					\underline{\makebox[\HUSTtitlelength]{\theauthor}} \\
					\makebox[4em][s]{学 \hfill 号} &
					\underline{\makebox[\HUSTtitlelength]{\stunum}} \\
					\makebox[4em][s]{指导教师} &
					\underline{\makebox[\HUSTtitlelength]{\instructor}} \\
			  \end{tabular}
		    }

			\vspace{4em}
			{\sanhao \hwzs \thedate}

		\end{center}
	\end{titlepage}
}

% ------------------------------------ 标题页 ----------------------------------- %
\title{求解线性常微分方程的模拟计算机设计} % 论文题目
\def\school{电子信息与通信学院} % 院系
\def\classnum{信卓2201班} % 专业班级
\author{董浩} % 姓名
\def\stunum{U202213781}	% 学号
\def\instructor{肖看} % 指导老师
\date{\today} % 日期

% -------------------------------- quickinput -------------------------------- %
% 利用\newcommand{cmd}{def} 设置一些常用的代码，提高效率，这里可以自行删除，下面是我敲翻译时候打的一些command。
\newcommand{\hongzifuzhu}[1]{\textcolor{red}{\kai \wuhao(#1)}}

% ---------------------------------------------------------------------------- %
%                                   document                                   %
% ---------------------------------------------------------------------------- %
\begin{document}

\maketitle % 生成标题页，个人建议直接使用学校给的word转成pdf与这里生成的pdf第一页合并，再去打印封皮。

% \thispagestyle{empty}% 标题页不参与编号
% ------------------------------------ 声明页 ----------------------------------- %
\setcounter{page}{1}
\renewcommand{\thepage}{\Roman{page}}


% ----------------------------------- 中文摘要 ----------------------------------- %
\setcounter{page}{1}
\renewcommand{\thepage}{\Roman{page}}
\begin{cnabstract}{模拟计算机；线性常微分方程；LM324；信号发生器；运算放大器}
	\hspace{2em}
	本设计制作的模拟计算机系统，利用2片LM324运算放大器芯片和若干电容、电阻以及二极管等元器件，可实现$\Omega = 600rad/s$的正弦波和同频同相的方波的生成。对于给定的线性常微分方程，初始条件和输入信号，可以实现对微分方程的求解。可在零输入、零响应以及全响应三种状态之间切换，计算出响应的结果，并将结果以信号的形式输出。
\end{cnabstract}

\newpage

\tableofcontents
\thispagestyle{main}


\clearpage
\setcounter{page}{1}
\renewcommand{\thepage}{\arabic{page}}

% ----------------------------------- 主体内容 ----------------------------------- %
\seccontent
\section{设计要求}

\subsection{具体要求}
利用测评板上提供的器件，设计制作一个求解下列微分方程的模拟计算机，如图1-1所示。
\begin{figure}[H]
	\centering
	\includegraphics[width=1\textwidth]{模拟计算机结构示意图}
	\caption{求解微分方程的模拟计算机结构示意图}
\end{figure}

\subsection{方案设计}
\vspace*{-2em}
\begin{figure}[H]
	\centering
	\includegraphics[width=1\textwidth]{方案设计框图}
	\caption{设计框图}
\end{figure}

\subsection{详细电路图}
\begin{figure}[H]
	\centering
	\includegraphics[width=1\textwidth]{原理图}
	\caption{原理图}
\end{figure}

\section{电路模块设计及参数计算}
\subsection{信号发生部分}
\subsubsection{文氏桥振荡电路}
\begin{figure}[H]
	\centering
	\includegraphics[width=1.0\textwidth]{文氏桥}
	\caption{文氏桥电路}
\end{figure}
\noindent 文氏桥振荡电路如图2-1所示：
振荡频率$f=\frac{1}{2\pi RC}$，令$f =96Hz$，得$RC=1.66mS$，取$R=16.7K\Omega$，得$C=100nF$，起振要求$R_f/R_g>2$，取$R_f=24K\Omega,R_g=10K\Omega$。

\subsubsection{三角波产生电路}
\begin{figure}[H]
	\centering
	\includegraphics[width=1.0\textwidth]{三角波产生电路}
	\caption{三角波产生电路}
\end{figure}
三角波产生电路如图2-2所示，采用过零比较器和反向积分电路处理正弦波得到三角波。正弦波经过过零比较器后输出方波，经过两个二极管限幅后送入积分电路，输出三角波。
积分电路输出三角波的幅值为$V=\frac{Vi}{CRf}$，其中经过二极管限幅后，输入信号的幅值为0.7V左右，为保证输出的幅值在1V以上，取$R=7.8k\Omega,C=100nF$，同时为了保证积分器不饱和，需要在电容的两端并联一个泄流电阻，取$R=90K\Omega$。

\subsection{运算部分}
\subsubsection{总体思路}
运算部分由一个差分减法器和两个积分放大器组成。差分减法器的一个输入端连接输入，另一个输入端连接输出，形成反馈。差分减法器的输出$V_{o1}=\frac{3}{4}V_i-V_o$，第一级积分器对差分减法器的输出信号积分后，再由第二级积分放大器对其积分，得到输出信号$V_o$。同时，可通过控制电容的初始电压从而控制微分方程解的初始条件。

对于二阶常微分方程：$$\frac{d^2u_o(t)}{dt^2}+4\times10^4u_o(t)=3\times10^4u_i(t)$$,\\可化简为$$\frac{1}{4\times10^4}\times\frac{d^2u_o(t)}{dt^2}=\frac{3}{4}u_i(t)-u_o(t)$$
故第一级先使用差分减法器得到:
$$u_{01}=\frac{3}{4}u_i-u_o$$
第二级和第三极使用积分器：
\begin{equation}
	\begin{aligned}
		u_{02}(t)=-\frac{1}{RC}\int u_{o1}(t)dt \\ u_o(t)=\frac{1}{R^2 C^2}\int u_{o1}(t)dt
	\end{aligned}
	\nonumber
\end{equation}
故积分器的积分常数应控制为200。

\subsubsection{差分减法器}
差分减法器的输出$V_{o1}=\frac{3}{4}V_i-V_o$，由相关电路知识分析可知，$\frac{R_2}{R_1}=1$，$\frac{R_3}{R_4}=\frac{5}{3}$。考虑电路实际情况，可取$R_1=R_2=10K\Omega,R_3=5K\Omega,R_4=3K\Omega$。

\subsubsection{积分部分}
根据本题中所给的微分方程，积分器的积分常数应控制为200，根据积分电路的传输公式，有$\frac{1}{RC}=200$，取$R=50K\Omega$，则$C=100nF$。

同时，根据给定的如下初始条件：
$$
	u_o(0)=1V, \hspace{1em} \frac{du_o(0)}{dt}=0V/s
$$
可得第一级积分器的电容的初始电压为0V，第二级积分器的初始电压为1V。

\section{测试结果}
\subsection{信号发生部分}
信号发生部分工作正常，输出稳定的正弦和三角波形，如图所示：
\begin{figure}[H]
	\centering
	\includegraphics[width=1.0\textwidth]{正弦波}
	\caption{正弦波}
\end{figure}
但是正弦波接上负载后，正弦波的幅值减小，频率升高，从而对生成的三角波有一定影响：
\begin{figure}[H]
	\centering
	\includegraphics[width=1.0\textwidth]{衰减的正弦波}
	\caption{正弦波——接负载}
\end{figure}
\begin{figure}[H]
	\centering
	\includegraphics[width=1.0\textwidth]{三角波——信号源}
	\caption{三角波——信号源}
\end{figure}
\subsection{运算部分}
差分减法器和积分部分工作正常，使用100Hz，2Vpp的方波信号测试，输出正常：
\begin{figure}[H]
	\centering
	\includegraphics[width=0.9\textwidth]{三角波——积分电路}
	\caption{三角波——积分电路}
\end{figure}
测试零输入响应输出异常，t=0时刻产生正弦波形后快速衰减，10$\tau$后几乎下降为0，猜测与增益倍数不够，以及输入信号和输出信号的相位差有关。
\end{document}
